<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cerbi — Document</title>
  <link rel="stylesheet" href="../styles/cerbi-theme.css" />
  <link rel="stylesheet" href="../styles/cerbi-fixes.css" />
  <style>
    main{max-width:900px;margin:calc(var(--nav-h,64px) + 24px) auto 80px;padding:0 16px}
    .doc{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:22px}
    .doc h1,.doc h2,.doc h3{letter-spacing:.01em}
    .doc pre{overflow:auto;background:rgba(0,0,0,.4);padding:12px;border-radius:10px}
    .doc a{color:var(--accent);}
  </style>
</head>
<body>
  <main class="container">
    <article id="md" class="doc">Loading…</article>
  </main>

  <!-- Marked (MD -> HTML) + DOMPurify (sanitize) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  <script>
    (async function () {
      const el = document.getElementById('md');
      const p = new URLSearchParams(location.search);
      const file = p.get('file');
      if (!file || !/^[\w\-\/\.]+\.md$/i.test(file)) { el.textContent = 'Missing or invalid file.'; return; }
      try {
        const res = await fetch('../' + file.replace(/^\.\/+/, ''), { cache: 'no-cache' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const md = await res.text();
        const html = DOMPurify.sanitize(marked.parse(md));
        el.innerHTML = html;
        const h1 = el.querySelector('h1');
        if(h1) document.title = h1.textContent + ' — Cerbi';
        // GA4 custom event (safe guard if gtag present)
        try { if (typeof gtag === 'function') { gtag('event','doc_view',{file:file}); } } catch(_){}
      } catch (e) {
        el.textContent = 'Could not load document.';
      }
    })();
  </script>
</body>
</html>